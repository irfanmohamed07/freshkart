<%- include('../partials/header') %>

<div class="container max-w-screen-xl mx-auto px-4 py-8">
    <!-- Shop Header -->
    <div class="bg-white border border-gray-200 overflow-hidden mb-8">
        <!-- Shop banner/header -->
        <div class="relative h-56 bg-gray-100">
            <% if (shop.logo) { %>
                <div class="absolute inset-0">
                    <img src="<%= shop.logo %>" alt="<%= shop.name %>" class="w-full h-full object-cover">
                    <div class="absolute inset-0 bg-gradient-to-t from-black/70 to-black/10"></div>
                </div>
            <% } %>
            <div class="absolute bottom-0 left-0 p-6 w-full">
                <div class="flex items-center flex-wrap gap-2 mb-3">
                    <span class="bg-purple-100 text-purple-800 text-xs font-medium px-2.5 py-1 rounded-full">
                        <i class="fas fa-shopping-basket mr-1"></i> Grocery
                    </span>
                    <span class="bg-blue-600 text-white text-xs font-medium px-2.5 py-1 rounded-full">
                        20% OFF up to ₹100
                    </span>
                    <span class="bg-green-100 text-green-800 text-xs font-medium px-2.5 py-1 rounded-full">
                        <i class="fas fa-clock mr-1"></i> 10-20 min
                    </span>
                </div>
                <h1 class="text-3xl font-bold text-white mb-2"><%= shop.name %></h1>
                <div class="flex flex-wrap items-center gap-4 text-white/90 text-sm">
                    <div class="flex items-center">
                        <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-green-500 text-white mr-2">
                            4.2
                            <i class="fas fa-star ml-1 text-xs"></i>
                        </span>
                        <span>500+ ratings</span>
                    </div>
                    <div class="flex items-center">
                        <i class="fas fa-map-marker-alt mr-2"></i>
                        <%= shop.address %>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Shop details bar -->
        <div class="px-6 py-4 flex flex-wrap justify-between items-center">
            <div class="flex flex-wrap items-center gap-6 mb-2 md:mb-0">
                <div class="flex items-center text-gray-700">
                    <i class="fas fa-clock mr-2 text-purple-500"></i>
                    <span>Open: 8:00 AM - 10:00 PM</span>
                </div>
                <% if (shop.contact) { %>
                    <div class="flex items-center text-gray-700">
                        <i class="fas fa-phone-alt mr-2 text-purple-500"></i>
                        <span><%= shop.contact %></span>
                    </div>
                <% } %>
                <div class="flex items-center text-gray-700">
                    <i class="fas fa-truck mr-2 text-purple-500"></i>
                    <span>Free delivery above ₹200</span>
                </div>
            </div>
            <div class="flex space-x-4">
                <button class="flex items-center text-gray-700 hover:text-purple-600 transition-colors px-3 py-1.5 rounded-full hover:bg-gray-100">
                    <i class="far fa-bookmark mr-1"></i>
                    <span>Save</span>
                </button>
                <button class="flex items-center text-gray-700 hover:text-purple-600 transition-colors px-3 py-1.5 rounded-full hover:bg-gray-100">
                    <i class="fas fa-share-alt mr-1"></i>
                    <span>Share</span>
                </button>
            </div>
        </div>
    </div>
    
    <div class="flex flex-col lg:flex-row gap-8">
        <!-- Main content -->
        <div class="lg:w-8/12">
            <!-- Search & Filters -->
            <div class="bg-white border border-gray-200 p-4 mb-6">
                <div class="relative">
                    <input type="text" placeholder="Search for products..." class="w-full bg-gray-100 border-none rounded-full px-4 py-2 focus:ring-2 focus:ring-purple-500 focus:outline-none">
                    <button class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
                <div class="mt-4 flex flex-wrap gap-2">
                    <button class="bg-purple-600 text-white px-4 py-2 text-sm font-semibold">All</button>
                    <button class="bg-gray-100 text-gray-700 px-4 py-2 text-sm font-semibold hover:bg-gray-200 transition-colors">Fruits</button>
                    <button class="bg-gray-100 text-gray-700 px-4 py-2 text-sm font-semibold hover:bg-gray-200 transition-colors">Vegetables</button>
                    <button class="bg-gray-100 text-gray-700 px-4 py-2 text-sm font-semibold hover:bg-gray-200 transition-colors">Dairy</button>
                    <button class="bg-gray-100 text-gray-700 px-4 py-2 text-sm font-semibold hover:bg-gray-200 transition-colors">Bakery</button>
                    <button class="bg-gray-100 text-gray-700 px-4 py-2 text-sm font-semibold hover:bg-gray-200 transition-colors">Beverages</button>
                </div>
            </div>
            
            <!-- Products count -->
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl font-bold text-gray-800">Products (<%= pagination.totalProducts %>)</h2>
                <div class="relative">
                    <select class="appearance-none border border-gray-200 rounded-lg py-2 px-4 pr-8 bg-white text-gray-700 text-sm cursor-pointer">
                        <option>Sort: Recommended</option>
                        <option>Price: Low to High</option>
                        <option>Price: High to Low</option>
                        <option>Popularity</option>
                    </select>
                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                        <i class="fas fa-chevron-down text-xs"></i>
                    </div>
                </div>
            </div>
            
            <!-- Products list -->
            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                <% products.forEach(product => { %>
                    <div class="udemy-card group">
                        <a href="/products/<%= product.id %>" class="block">
                            <div class="relative h-40 md:h-48 overflow-hidden">
                                <% if (product.image_url) { %>
                                    <img src="<%= product.image_url %>" alt="<%= product.name %>" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300">
                                <% } else { %>
                                    <div class="w-full h-full bg-gray-100 flex items-center justify-center">
                                        <i class="fas fa-shopping-basket text-3xl text-gray-300"></i>
                                    </div>
                                <% } %>
                                <div class="absolute top-3 right-3 bg-white/90 backdrop-blur-sm text-xs rounded-md px-2 py-1 font-medium shadow-sm">
                                    <span class="flex items-center text-amber-500">
                                        <i class="fas fa-star mr-1 text-xs"></i>
                                        <span>4.1</span>
                                    </span>
                                </div>
                                <div class="absolute top-3 left-3 bg-green-500 text-white text-xs px-2 py-1 rounded-md font-medium">
                                    <span>10% OFF</span>
                                </div>
                                <div class="absolute bottom-0 left-0 right-0 h-16 bg-gradient-to-t from-black/60 to-transparent"></div>
                            </div>
                        </a>
                        <div class="p-4">
                            <div class="flex justify-between items-start mb-1">
                                <a href="/products/<%= product.id %>" class="block">
                                    <h3 class="font-medium text-base line-clamp-1 hover:text-purple-600 transition-colors"><%= product.name %></h3>
                                </a>
                            </div>
                            <div class="text-xs text-gray-500 mb-2">Sold by <%= shop.name %></div>
                            <div class="flex justify-between items-center mb-3">
                                <div class="flex items-baseline">
                                    <span class="text-gray-900 font-bold text-lg">₹<%= 
                                    (function() {
                                        try {
                                            return typeof product.price === 'number' 
                                                ? parseFloat(product.price).toFixed(2) 
                                                : parseFloat(product.price).toFixed(2);
                                        } catch (e) {
                                            return product.price;
                                        }
                                    })()
                                    %></span>
                                    <span class="ml-2 text-xs text-gray-500 line-through">₹<%= 
                                    (function() {
                                        try {
                                            const price = typeof product.price === 'number' 
                                                ? product.price
                                                : parseFloat(product.price);
                                            return (price * 1.1).toFixed(2);
                                        } catch (e) {
                                            return product.price;
                                        }
                                    })()
                                    %></span>
                                </div>
                                <span class="text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded-full">per unit</span>
                            </div>
                            <div class="flex items-center text-xs text-gray-500 mb-3">
                                <i class="fas fa-clock mr-1"></i>
                                <span>Delivery in 10-20 mins</span>
                            </div>
                            <% if (locals.user) { %>
                                <form action="/cart/add" method="POST" class="cart-add-form mt-2">
                                    <input type="hidden" name="product_id" value="<%= product.id %>">
                                    <input type="hidden" name="shop_id" value="<%= shop.id %>">
                                    <input type="hidden" name="quantity" value="1">
                                    <button type="submit" class="w-full udemy-btn text-sm py-2.5 flex items-center justify-center">
                                        <i class="fas fa-shopping-cart mr-2"></i>
                                        <span>Add to Cart</span>
                                    </button>
                                </form>
                            <% } else { %>
                                <a href="/login" class="w-full udemy-btn text-sm py-2.5 flex items-center justify-center mt-2">
                                    <i class="fas fa-sign-in-alt mr-2"></i>
                                    <span>Login to Add</span>
                                </a>
                            <% } %>
                        </div>
                    </div>
                <% }) %>
            </div>
            
            <% if (products.length === 0) { %>
                <div class="bg-yellow-50 p-6 rounded-lg border border-yellow-200 mt-8 text-center">
                    <img src="https://b.zmtcdn.com/web/assets/276b62881039c7b0f671ccc42f3efcd51620103037.png" alt="No products found" class="w-48 h-auto mx-auto mb-4">
                    <h2 class="text-xl font-semibold mb-2 text-gray-800">No products found</h2>
                    <p class="text-gray-600 mb-4">We couldn't find any products for this shop.</p>
                </div>
            <% } %>
            
            <% if (pagination.totalPages > 1) { %>
                <div class="mt-8 flex justify-center">
                    <nav class="inline-flex rounded-md shadow-sm">
                        <% if (pagination.page > 1) { %>
                            <a href="/shops/<%= shop.id %>?page=<%= pagination.page - 1 %>" class="px-4 py-2 border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 rounded-l-md">
                                <i class="fas fa-chevron-left mr-1"></i> Previous
                            </a>
                        <% } else { %>
                            <span class="px-4 py-2 border border-gray-300 bg-gray-100 text-gray-400 cursor-not-allowed rounded-l-md">
                                <i class="fas fa-chevron-left mr-1"></i> Previous
                            </span>
                        <% } %>
                        
                        <% for (let i = 1; i <= pagination.totalPages; i++) { %>
                            <% if (i === pagination.page) { %>
                                <span class="px-4 py-2 border border-red-500 bg-red-500 text-white font-medium">
                                    <%= i %>
                                </span>
                            <% } else if (i === 1 || i === pagination.totalPages || (i >= pagination.page - 1 && i <= pagination.page + 1)) { %>
                                <a href="/shops/<%= shop.id %>?page=<%= i %>" class="px-4 py-2 border border-gray-300 bg-white text-gray-700 hover:bg-gray-50">
                                    <%= i %>
                                </a>
                            <% } else if (i === pagination.page - 2 || i === pagination.page + 2) { %>
                                <span class="px-4 py-2 border border-gray-300 bg-white text-gray-700">
                                    ...
                                </span>
                            <% } %>
                        <% } %>
                        
                        <% if (pagination.page < pagination.totalPages) { %>
                            <a href="/shops/<%= shop.id %>?page=<%= pagination.page + 1 %>" class="px-4 py-2 border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 rounded-r-md">
                                Next <i class="fas fa-chevron-right ml-1"></i>
                            </a>
                        <% } else { %>
                            <span class="px-4 py-2 border border-gray-300 bg-gray-100 text-gray-400 cursor-not-allowed rounded-r-md">
                                Next <i class="fas fa-chevron-right ml-1"></i>
                            </span>
                        <% } %>
                    </nav>
                </div>
            <% } %>
        </div>
        
        <!-- Sidebar -->
        <div class="lg:w-4/12">
            <!-- Shop info card -->
            <div class="bg-white border border-gray-200 p-5 mb-6">
                <h3 class="text-lg font-bold mb-4 text-gray-800">Shop Information</h3>
                <div class="space-y-4">
                    <div class="flex">
                        <div class="flex-shrink-0 w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center text-purple-600">
                            <i class="fas fa-map-marker-alt"></i>
                        </div>
                        <div class="ml-3">
                            <p class="font-medium text-gray-800 mb-1">Address</p>
                            <p class="text-gray-600 text-sm"><%= shop.address %></p>
                        </div>
                    </div>
                    <% if (shop.contact) { %>
                        <div class="flex">
                            <div class="flex-shrink-0 w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center text-purple-600">
                                <i class="fas fa-phone-alt"></i>
                            </div>
                            <div class="ml-3">
                                <p class="font-medium text-gray-800 mb-1">Phone</p>
                                <p class="text-gray-600 text-sm"><%= shop.contact %></p>
                            </div>
                        </div>
                    <% } %>
                    <div class="flex">
                        <div class="flex-shrink-0 w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center text-purple-600">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="ml-3">
                            <p class="font-medium text-gray-800 mb-1">Hours</p>
                            <p class="text-gray-600 text-sm">8:00 AM - 10:00 PM</p>
                        </div>
                    </div>
                    <div class="flex">
                        <div class="flex-shrink-0 w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center text-purple-600">
                            <i class="fas fa-truck"></i>
                        </div>
                        <div class="ml-3">
                            <p class="font-medium text-gray-800 mb-1">Delivery</p>
                            <p class="text-gray-600 text-sm">Free on orders above ₹200</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Shop offers -->
            <div class="bg-white border border-gray-200 p-5 mb-6">
                <h3 class="text-lg font-bold mb-4 text-gray-800">Available Offers</h3>
                <div class="space-y-4">
                    <div class="bg-purple-50 rounded-lg p-4 flex items-start border border-purple-100">
                        <div class="mr-3 text-purple-600">
                            <i class="fas fa-tag"></i>
                        </div>
                        <div>
                            <p class="font-medium text-gray-800">20% OFF up to ₹100</p>
                            <p class="text-gray-600 text-sm">Use code WELCOME20</p>
                        </div>
                    </div>
                    <div class="bg-blue-50 rounded-lg p-4 flex items-start border border-blue-100">
                        <div class="mr-3 text-blue-600">
                            <i class="fas fa-percent"></i>
                        </div>
                        <div>
                            <p class="font-medium text-gray-800">Free delivery on orders above ₹200</p>
                            <p class="text-gray-600 text-sm">Automatic at checkout</p>
                        </div>
                    </div>
                    <div class="bg-green-50 rounded-lg p-4 flex items-start border border-green-100">
                        <div class="mr-3 text-green-600">
                            <i class="fas fa-wallet"></i>
                        </div>
                        <div>
                            <p class="font-medium text-gray-800">10% cashback up to ₹50</p>
                            <p class="text-gray-600 text-sm">On all orders with UPI payments</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Back to shops -->
            <div class="mt-4">
                <a href="/shops" class="inline-flex items-center udemy-text-primary hover:underline font-semibold">
                    <i class="fas fa-arrow-left mr-2"></i>
                    <span>Back to All Shops</span>
                </a>
            </div>
        </div>
    </div>
</div>

<%- include('../partials/footer') %> 